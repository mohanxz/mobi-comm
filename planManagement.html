<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Plan Management</title>
    <link rel="stylesheet" href="css/mainmin.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/adminDashboard.css">
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        .tabs {
            display: flex;
            background: #fff;
            border-radius: 50px;
            padding: 10px;
            position: relative;
            left: 110px;
            box-shadow: rgba(0, 0, 0, 0.4) 0px 2px 4px, rgba(0, 0, 0, 0.3) 0px 7px 13px -3px, rgba(0, 0, 0, 0.2) 0px -3px 0px inset;


        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            
        }

        .tab.active {
            font-weight: bold;
            color: #d52136;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        #main-content{
            width:85%;
        
        }
        /* Ensure main content takes up remaining space */
#main-content {
    width: calc(100% - 90px);
    margin-left:-20px;
}

/* Sidebar styles */
aside {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: 250px;
    background: #f8f9fa;
    padding: 15px;
    overflow-y: auto;
    border-right: 1px solid #ddd;
}

/* Ensure cards adjust properly */
.plan-card {
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: 0.3s;
    margin-left: 100px;
}

.plan-card:hover {
    transform: translateY(-5px);
}

.plan-buttons {
    display: flex;
    gap: 10px;
}

.input{
    position: relative;
    left: 130px;
    

}

#header{
    position: relative;
    left: 100px;
    color: #d52136;
}

@media(min-width:700px){
    #main-content{
        position: relative;
        left: 100px;
    }
    .tabs{
        position: relative;
        width:80%;
    }
}


@media(max-width:600px){
    #navBtn{
        height: 40px;
    }
    #main-content{
        position: relative;
        left: -220px;
        top: 50px;
    }
    .tabs{
        width: 430px;
        position: relative;
    }
}
    </style>
</head>

    <body class="container-fluid mt-4">
        <div class="d-flex">
            <!-- Sidebar -->
            <aside class="d-none d-md-block bg-light p-3" style="width: 250px; min-height: 100vh;">
                <div class="text-center">
                    <img src="src/images/mobi-comm-named-logo-removebg-preview.png" alt="" style="width: 180px;">
                </div>
                <nav class="mt-3">
                    <ul class="list-unstyled">
                        <li class="p-2 rounded mb-2">
                            <a href="#" class="text-dark text-decoration-none">Expiring Recharges</a>
                        </li>
                        <li class="p-2   rounded mb-2">
                            <a href="http://127.0.0.1:5501/subscriberManagement.html" class="text-dark text-decoration-none">Subscribers</a>
                        </li>
                        <li class="p-2 rounded mb-2 bg-danger">
                            <a href="#" class="text-light text-decoration-none">Plans</a>
                        </li>
                        <li class="p-2 rounded mb-2">
                            <a href="http://127.0.0.1:5501/RechargeManagement.html#" class="text-dark text-decoration-none">Recharge Management</a>
                        </li>
                        <li class="p-2 rounded mb-2">
                            <a href="#" class="text-dark text-decoration-none">Complaint Management</a>
                        </li>
                    </ul>
                </nav>
            </aside>
            <button class="btn btn-danger d-md-none" type="button" id="navBtn" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar">
                ☰ Menu
            </button>
            
            <div class="offcanvas offcanvas-start d-md-none" id="mobileSidebar">
                <div class="offcanvas-header">
                    <h5 class="text-danger fw-bold">MOBI-COMM</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                </div>
                <div class="offcanvas-body">
                    <nav>
                        <ul class="list-unstyled">
                            <li class="p-2 bg-danger text-white rounded mb-2">
                                <a href="http://127.0.0.1:5501/AdminDashboard.html" class="text-white text-decoration-none">Expiring Recharges</a>
                            </li>
                            <li class="p-2 text-dark rounded mb-2">
                                <a href="http://127.0.0.1:5501/subscriberManagement.html" class="text-dark text-decoration-none">Subscribers</a>
                            </li>
                            <li class="p-2 text-dark rounded mb-2">
                                <a href="http://127.0.0.1:5501/planManagement.html" class="text-dark text-decoration-none">Plans</a>
                            </li>
                            <li class="p-2 text-dark rounded mb-2">
                                <a href="#" class="text-dark text-decoration-none">Complaint Management</a>
                            </li>
                            <li class="p-2 text-dark rounded mb-2">
                                <a href="#" class="text-dark text-decoration-none">Admin Controls</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            
            
    
            <!-- Main Content -->
            <div id="main-content" class="flex-grow-1 p-3">
                <h1 class="mb-3 ms-5" id="header">Admin Plan Management</h1>
    
                <!-- Tabs -->
                <div class="tabs ms-5">
                    <div class="tab active" data-category="recommended">Recommended</div>
                    <div class="tab" data-category="validity">Validity</div>
                    <div class="tab" data-category="data">Data</div>
                    <div class="tab" data-category="unlimited">Unlimited 5G</div>
                    <div class="tab" data-category="ott">OTT</div>
                </div>

                <div class="input">

                    <input type="text" id="searchBar" class="form-control ms-5 mt-5 d-inline input-style py-3 pe-5" 
        placeholder=" Search plans..." style="width: 300px;"><i class="fas fa-search text-"></i>
        <button class="btn  ms-5 d-inline add-btn text-light" id="addPlanBtn">➕ Add New Plan</button>
    
        
                </div>
    
                <!-- Plans Container -->
                <div id="plansContainer" class="row mt-3"></div>
            </div>
        </div>
     
        <!-- Add Plan Modal -->
        <div class="modal fade" id="addPlanModal" tabindex="-1" aria-labelledby="addPlanModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New Plan</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <label>Plan Name:</label>
                        <input type="text" id="newPlanName" class="form-control">
    
                        <label>Price:</label>
                        <input type="text" id="newPlanPrice" class="form-control">
    
                        <label>Validity:</label>
                        <input type="text" id="newPlanValidity" class="form-control">
    
                        <label>Features:</label>
                        <textarea id="newPlanFeatures" class="form-control"></textarea>
    
                        <label>Label:</label>
                        <input type="text" id="newPlanLabel" class="form-control">
                        <img src="" alt="">
    
                        <label>Select Plan Badge:</label>
                        <select id="newPlanBadge" class="form-control">
                            <option value="none" selected>None</option>
                            <option value="src/images/best-seller-banner_175838-470-removebg-preview.png" style="width: 400px;">Best Seller</option>
                            <option value="src/images/special-offer-creative-sale-banner-design.png">Budget Friendly</option>
                            <option value="img3.png">Most Popular</option>
                            <option value="img4.png">Limited Offer</option>
                        </select>
    
                        <!-- <img src="src/images/special-offer-creative-sale-banner-design.png" alt=""> -->
                        <div class="mt-3 text-center">
                            <img id="selectedBadgePreview" src="" style="display:none; width: 50px; height: 50px;">
                        </div>
                    </div>6
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="saveNewPlan">Save Plan</button>
                    </div>
                </div>
            </div>
        </div>
    
</body>
    
    <!-- Tabs -->
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        
        let currentCategory = "recommended";
        let editingPlanId = null;

        
    
        function loadAdminPlans() {
            
            $.get(`http://localhost:3000/${currentCategory}`, function (plans) {
                $("#plansContainer").html("");




                
                plans.forEach(plan => {
                    
                    let badgeHtml = plan.badge && plan.badge !== "none" ? 
                        `<img src="${plan.badge}" class="position-absolute top-0 end-0 mt-2 me-2" style="width:100px;">` 
                        : '';
    
                    let card = `
                    <div class="col-lg-3 g-5 mx-5"style="margin-left:0px;">
                           <div class="plan-card ${plan.hidden ? 'bg-light' : ''}">
                            ${badgeHtml}
                            <div class="plan-header position-relative"style="left:-30px;top:-29px" >${plan.label} ${plan.hidden ? '(Hidden)' : ''}</div>
                            <h5 class="plan-title">${plan.plan_name} - <span style="font-size: 14px; color: #888;">
                            <p class="plan-price">${plan.price}/${plan.validity}</p>
                            <ul class="plan-features">
                                ${plan.features.map(f => `<li><i class="fa-solid fa-check-circle"></i> ${f}</li>`).join('')}
                            </ul>
                            <button class="proceed-btn">Recharge ${plan.price} Plan</button>
                            <div class="plan-buttons position-relative"style="left:70px;top:10px">
                              <button class="btn text-light  ${plan.hidden ? 'unhide' : 'hide'} toggle-hide" data-id="${plan.id}">
                                 ${plan.hidden 
                                     ? '<i class="fa-solid fa-eye"></i> Unhide'  
                                     : '<i class="fa-solid fa-eye-slash text-light"></i> Hide'} 
                             </button>

                                <button class="btn edit edit-plan text-light" data-id="${plan.id}"><i class="fas fa-edit text-light"></i> Edit</button>
                            </div>
                        </div>
                        </div>`;
                    $("#plansContainer").append(card);
                });
            });
        }
    
        $(document).on("click", ".tab", function() {
            $(".tab").removeClass("active");
            $(this).addClass("active");
            currentCategory = $(this).data("category");
            loadAdminPlans();
        });
    
        $("#addPlanBtn").click(function () {
            editingPlanId = null;  // Reset editing state
            $("#newPlanName, #newPlanPrice, #newPlanValidity, #newPlanFeatures, #newPlanLabel").val("");
            $("#newPlanBadge").val("none");
            $("#selectedBadgePreview").hide();
            new bootstrap.Modal(document.getElementById('addPlanModal')).show();
        });
    
        $("#newPlanBadge").change(function () {
            let selectedImage = $(this).val();
            if (selectedImage === "none") {
                $("#selectedBadgePreview").hide();
            } else {
                $("#selectedBadgePreview").attr("src", selectedImage).show();
            }
        });
    
        $("#saveNewPlan").click(function () {
    let newPlan = {
        plan_name: $("#newPlanName").val().trim(),
        price: $("#newPlanPrice").val().trim(),
        validity: $("#newPlanValidity").val().trim(),
        features: $("#newPlanFeatures").val().trim().split("\n"),
        label: $("#newPlanLabel").val().trim(),
        badge: $("#newPlanBadge").val(),
        hidden: false
    };

    if (!newPlan.plan_name || !newPlan.price || !newPlan.validity) {
        alert("Please fill in all required fields.");
        return;
    }

    console.log("Sending new plan:", newPlan); // Debugging

    $.ajax({
        url: `http://localhost:3000/${currentCategory}`,
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify(newPlan),
        success: function () {
            console.log("Plan added successfully!"); // Debugging
            bootstrap.Modal.getInstance(document.getElementById('addPlanModal')).hide();
            loadAdminPlans();
        },
        error: function (err) {
            console.error("Error adding plan:", err);
            alert("Failed to add plan. Check the console for details.");
        }
    });
});

        $(document).on("click", ".toggle-hide", function () {
            
            let planId = $(this).data("id");
    
            $.get(`http://localhost:3000/${currentCategory}/${planId}`, function (plan) {
                plan.hidden = !plan.hidden;  // Toggle visibility
    
                $.ajax({
                    url: `http://localhost:3000/${currentCategory}/${planId}`,
                    type: "PUT",
                    contentType: "application/json",
                    data: JSON.stringify(plan),
                    success: function () {
                        loadAdminPlans();
                    }
                });
            });
        });
    
        $(document).on("click", ".edit-plan", function () {
            let planId = $(this).data("id");
            editingPlanId = planId;
    
            $.get(`http://localhost:3000/${currentCategory}/${planId}`, function (plan) {
                $("#newPlanName").val(plan.plan_name);
                $("#newPlanPrice").val(plan.price);
                $("#newPlanValidity").val(plan.validity);
                $("#newPlanFeatures").val(plan.features.join("\n"));
                $("#newPlanLabel").val(plan.label);
                $("#newPlanBadge").val(plan.badge);
                $("#newPlanCode").val(plan.plan_name);
    
                if (plan.badge !== "none") {
                    $("#selectedBadgePreview").attr("src", plan.badge).show();
                } else {
                    $("#selectedBadgePreview").hide();
                }
    
                new bootstrap.Modal(document.getElementById('addPlanModal')).show();
            });
        });

        
    
        $(document).ready(loadAdminPlans);
        $("#searchBar").on("input", function () {
    let searchQuery = $(this).val().toLowerCase();

    $(".plan-card").each(function () {
        let card = $(this);
        let cardText = card.text().toLowerCase();

        if (cardText.includes(searchQuery)) {
            card.show();  // Show matching cards
        } else {
            card.hide();  // Hide non-matching cards
        }
    });
});

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    
</body>
</html>
