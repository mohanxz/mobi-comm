<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin- Home</title>
  <link rel="stylesheet" href="css/admin.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="/css/mainmin.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="sidebar d-flex flex-column">
    <h2 class="text-center sidebar-heading"> Admin Panel</h2>
    <a href="http://127.0.0.1:5500/AdminPanel.html#" class="active"> Home</a>
    <a href="http://127.0.0.1:5500/subscriberManagement.html"> Subscribers</a>
    <a href="#"> Recharge History</a>
    <a href="#"> Admin Settings</a>
  </div>

  <div class="main-content">
    <nav class="navbar navbar-expand-lg navbar-light  shadow-sm mb-4">
      <div class="container-fluid">
        <h2 class="navbar-brand">Dashboard</h2>
        <button class="btn btn-danger">Logout</button>
      </div>
    </nav>

    <!-- Title -->
    <h2 class="text-secondary">Users with Plans Expiring Soon</h2>

    <!-- Table placed on top -->
    <table class="table table-bordered mt-3">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Mobile</th>
          <th>Email</th>
          <th>Plan</th>
          <th>Expiry Date</th>
          <th>Days Left</th>
        </tr>
      </thead>
      <tbody id="userTable">
        <tr onclick="showDetails('John Doe', '1234567890', 'john@example.com', 'Basic (₹199)', '2025-02-25', 'Credit Card')">
          <td>John Doe</td>
          <td>1234567890</td>
          <td>john@example.com</td>
          <td>MC-19</td>
          <td>2025-02-25</td>
          <td>2</td>
        </tr>
        <tr onclick="showDetails('Jane Smith', '9876543210', 'jane@example.com', 'Premium (₹499)', '2025-02-26', 'UPI')">
          <td>Jane Smith</td>
          <td>9876543210</td>
          <td>jane@example.com</td>
          <td>MC-499</td>
          <td>2025-02-26</td>
          <td>3</td>
        </tr>
        <tr onclick="showDetails('Alice Johnson', '4561237890', 'alice@example.com', 'Gold (₹699)', '2025-03-01', 'Net Banking')">
          <td>Alice Johnson</td>
          <td>4561237890</td>
          <td>alice@example.com</td>
          <td>MC-699</td>
          <td>2025-03-01</td>
          <td>6</td>
        </tr>
        <tr onclick="showDetails('Bob Brown', '7894561230', 'bob@example.com', 'Silver (₹299)', '2025-02-24', 'Debit Card')">
          <td>Bob Brown</td>
          <td>7894561230</td>
          <td>bob@example.com</td>
          <td>MC-299</td>
          <td>2025-02-24</td>
          <td>1</td>
        </tr>
      </tbody>
    </table>

    
      <!-- Dummy Rank Graph Section -->
      <h3 class="mt-4"> Rank Graph</h3>
      <canvas id="rankChart"></canvas>

    </div>
  </div>

  <!-- Subscriber Details Modal -->
  <!-- <div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Subscriber Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="table table-striped">
            <tbody>
              <tr>
                <th>Name</th>
                <td id="detailName"></td>
              </tr>
              <tr>
                <th>Mobile</th>
                <td id="detailMobile"></td>
              </tr>
              <tr>
                <th>Email</th>
                <td id="detailEmail"></td>
              </tr>
              <tr>
                <th>Plan</th>
                <td id="detailPlan"></td>
              </tr>
              <tr>
                <th>Expiry Date</th>
                <td id="detailExpiry"></td>
              </tr>
              <tr>
                <th>Payment Method</th>
                <td id="detailPayment"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div> -->

  <script>
    function showDetails(name, mobile, email, plan, expiry, payment) {
      document.getElementById("detailName").innerText = name;
      document.getElementById("detailMobile").innerText = mobile;
      document.getElementById("detailEmail").innerText = email;
      document.getElementById("detailPlan").innerText = plan;
      document.getElementById("detailExpiry").innerText = expiry;
      document.getElementById("detailPayment").innerText = payment;
      new bootstrap.Modal(document.getElementById('detailModal')).show();
    }

    async function fetchExpiringUsers() {
      try {
        const response = await fetch('http://localhost:3000/users');
        const data = await response.json();
        const users = data.users;
        const expiringUsers = users.filter(user => user.days_to_expiry <= 3);

        document.getElementById("expiringCount").textContent = `Total Users Expiring in ≤ 3 Days: ${expiringUsers.length}`;
        renderChart(users.length, expiringUsers.length);
      } catch (error) {
        console.error("Error fetching users:", error);
        document.getElementById("expiringCount").textContent = "Failed to load data.";
      }
    }

    function renderChart(totalUsers, expiringUsers) {
      const ctx = document.getElementById('userChart').getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Expiring in 3 Days', 'Other Users'],
          datasets: [{
            data: [expiringUsers, totalUsers - expiringUsers],
            backgroundColor: ['#e74c3c', '#3498db']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top'
            }
          }
        }
      });
    }

    function renderRankChart() {
      const ctx = document.getElementById('rankChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Rank 1', 'Rank 2', 'Rank 3', 'Rank 4', 'Rank 5'],
          datasets: [{
            label: 'Dummy Rank Data',
            data: [100, 77, 90, 33, 52],
            borderColor: '#f39c12',
            backgroundColor: 'rgba(243, 156, 18, 0.2)',
            fill: true,
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    fetchExpiringUsers();
    renderRankChart();
  </script>
</body>

</html>/